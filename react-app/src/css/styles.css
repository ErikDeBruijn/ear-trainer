:root { --bg:#0b0c10; --panel:#111318; --text:#e7e9ee; --muted:#9aa1ac; --accent:#5eead4; --bad:#ef4444; --good:#22c55e; }
* { box-sizing: border-box; font-family: system-ui, -apple-system, Segoe UI, Inter, Roboto, Arial; }
body { margin:0; background:linear-gradient(180deg,#0b0c10,#0e1016); color:var(--text); }
.container { max-width:1100px; margin:auto; padding:20px; }
header { display:grid; grid-template-columns: 1fr; gap:12px; }
.title { font-weight:700; }

/* Settings Section */
.settings-section { margin-bottom: 12px; }
.settings-toggle { 
  width: 100%; 
  padding: 12px 16px; 
  background: var(--panel); 
  border: 1px solid #1e2633; 
  border-radius: 12px; 
  color: var(--text); 
  cursor: pointer; 
  display: flex; 
  justify-content: space-between; 
  align-items: center;
  font-weight: 600;
  transition: background-color 0.2s ease;
}
.settings-toggle:hover { background: #151a24; }
.settings-toggle-icon { 
  transition: transform 0.2s ease; 
  font-size: 14px;
}
.settings-toggle.collapsed .settings-toggle-icon { transform: rotate(-90deg); }
.settings-panel { 
  overflow: hidden; 
  transition: max-height 0.3s ease-out, opacity 0.2s ease-out;
  max-height: 0;
  opacity: 0;
  background: var(--panel);
  border: 1px solid #1e2633;
  border-radius: 0 0 12px 12px;
  border-top: none;
  margin-top: -1px;
}
.settings-panel.expanded { 
  max-height: 500px; 
  opacity: 1;
}
.training-mode-section {
  grid-column: 1 / -1;
  background: var(--darker);
  border: 1px solid var(--accent);
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 16px;
}

.mode-toggle {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  font-weight: 600;
}

.mode-label {
  font-size: 16px;
}

.level-info {
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid #333;
}

.current-level {
  font-weight: 600;
  color: var(--accent);
  margin-bottom: 4px;
}

.level-description {
  font-size: 14px;
  color: var(--muted);
}

.controls { 
  display: grid; 
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); 
  gap: 12px; 
  align-items: end; 
  padding: 16px;
}

/* Game Controls */
.game-controls { 
  display: flex; 
  gap: 12px; 
  justify-content: center;
}
label { font-size:12px; color:var(--muted); display:flex; flex-direction:column; gap:4px; }
select, button { padding:10px; border-radius:10px; border:1px solid #263243; background:#0f1320; color:var(--text); }
input[type="range"] { 
  padding: 10px 0; 
  background: transparent; 
  cursor: pointer;
}
input[type="range"]::-webkit-slider-track {
  background: #263243;
  height: 4px;
  border-radius: 2px;
}
input[type="range"]::-webkit-slider-thumb {
  appearance: none;
  background: var(--accent);
  height: 16px;
  width: 16px;
  border-radius: 50%;
  cursor: pointer;
}
input[type="range"]::-moz-range-track {
  background: #263243;
  height: 4px;
  border-radius: 2px;
  border: none;
}
input[type="range"]::-moz-range-thumb {
  background: var(--accent);
  height: 16px;
  width: 16px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
}
button.primary { background:var(--accent); color:#092823; border:none; font-weight:700; cursor:pointer; }
button.secondary { cursor:pointer; }
.panel { margin-top:14px; background:var(--panel); border:1px solid #1e2633; border-radius:16px; padding:16px; }

.hud { display:flex; gap:20px; margin-top:12px; font-variant-numeric: tabular-nums; }
.status { margin-top:10px; color:var(--muted); min-height:1.2em; }
.success { color: var(--good); }
.error { color: var(--bad); }
/* --- Feedback pill --- */
.status { margin-top:10px; min-height:1.6em; }
.status.status-pill { display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; font-weight:700; border:1px solid transparent; }
.status.status-pill.ok { background: rgba(34,197,94,.15); border-color: var(--good); color: var(--text); }
.status.status-pill.bad { background: rgba(239,68,68,.12); border-color: var(--bad); color: var(--text); }
@media (prefers-reduced-motion: no-preference) {
    .status.status-pill { animation: pop-in .18s ease-out; }
    @keyframes pop-in { from { transform: scale(.96); opacity:.0 } to { transform: scale(1); opacity:1 } }
}

/* --- Screen flash overlay --- */
#overlay-flash { position: fixed; inset: 0; pointer-events: none; opacity: 0; background: transparent; transition: opacity 120ms ease-out, background-color 120ms ease-out; }
#overlay-flash.flash-ok { background: #ffffff; opacity: 0.9; }
#overlay-flash.flash-bad { background: #ff2a2a; opacity: 0.35; }
@media (prefers-reduced-motion: reduce) {
  #overlay-flash { transition: none; }
}

/* --- Progress Bar --- */
.progress-container { margin-top: 16px; }
.progress-label { font-size: 12px; color: var(--muted); margin-bottom: 8px; font-weight: 500; }
.progress-bar { 
  width: 100%; 
  height: 8px; 
  background: #1e2633; 
  border-radius: 4px; 
  overflow: hidden;
  border: 1px solid #263243;
}
.progress-fill { 
  height: 100%; 
  width: 0%; 
  background: linear-gradient(90deg, var(--accent), #4fd1c7);
  border-radius: 3px;
  transition: width 0.3s ease-out;
  position: relative;
}
.progress-fill::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  animation: shimmer 2s infinite;
}
@keyframes shimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}
@media (prefers-reduced-motion: reduce) {
  .progress-fill { transition: none; }
  .progress-fill::after { animation: none; }
}

/* --- Piano Integration --- */
.piano-container { 
  margin: 12px 0; 
  display: flex; 
  justify-content: center;
}

/* Completely override piano.css with scoped styles for our dark theme */
#piano-keys { 
  height: 120px;
  display: flex;
  justify-content: center;
  background: var(--panel);
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #1e2633;
  position: relative;
}

#piano-keys .key { 
  background: #6b7280;
  border-radius: 8px;
  font-size: 10px;
  color: #333;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  padding-bottom: 8px;
  width: 36px;
  height: 96px;
  margin: 0 1px;
  cursor: pointer;
  transition: all 0.1s ease;
  z-index: 3;
  position: relative;
}

#piano-keys .key:hover {
  background: #f0f0f0;
}

#piano-keys .key.sharp { 
  background: #333;
  color: var(--text);
  width: 20px;
  height: 60px;
  z-index: 10;
  position: absolute;
  top: 12px;
  pointer-events: auto;
}

#piano-keys .key.sharp:hover {
  background: #444;
}

/* Sharp key positioning - centered between white keys with 39px offset */
#piano-keys .key.sharp[data-note="49"] { left: 39px; } /* C#3 */
#piano-keys .key.sharp[data-note="51"] { left: 77px; } /* D#3 */
#piano-keys .key.sharp[data-note="54"] { left: 153px; } /* F#3 */
#piano-keys .key.sharp[data-note="56"] { left: 191px; } /* G#3 */
#piano-keys .key.sharp[data-note="58"] { left: 229px; } /* A#3 */
#piano-keys .key.sharp[data-note="61"] { left: 305px; } /* C#4 */
#piano-keys .key.sharp[data-note="63"] { left: 343px; } /* D#4 */
#piano-keys .key.sharp[data-note="66"] { left: 419px; } /* F#4 */
#piano-keys .key.sharp[data-note="68"] { left: 457px; } /* G#4 */
#piano-keys .key.sharp[data-note="70"] { left: 495px; } /* A#4 */

#piano-keys .key.highlighted { 
  background: var(--accent) !important;
  color: #092823 !important;
  box-shadow: 0 0 8px var(--accent) !important;
}

#piano-keys .key.sharp.highlighted { 
  background: var(--accent) !important;
  color: #092823 !important;
}

#piano-keys .key.playing {
  background: #ddd !important;
  transform: translateY(2px);
}

#piano-keys .key.sharp.playing {
  background: #555 !important;
  transform: translateY(2px);
}

/* Scale highlighting - bright blue for notes in current key */
#piano-keys .key.in-scale {
  background: #0088ff !important; /* Bright blue */
  color: white !important;
}

#piano-keys .key.sharp.in-scale {
  background: #0088ff !important; /* Bright blue */
  color: white !important;
}

/* Home note highlighting - bright white for root note of key */
#piano-keys .key.home-note {
  background: #ffffff !important; /* Bright white like ROLI */
  color: #333 !important;
  box-shadow: 0 0 8px rgba(255, 255, 255, 0.6) !important;
}

#piano-keys .key.sharp.home-note {
  background: #ffffff !important; /* Bright white like ROLI */
  color: #333 !important;
  box-shadow: 0 0 8px rgba(255, 255, 255, 0.6) !important;
}

/* Active note highlighting - currently pressed keys (correct) */
#piano-keys .key.active {
  background: #00ff00 !important; /* Bright green for correct */
  color: black !important;
  transform: translateY(2px);
}

#piano-keys .key.sharp.active {
  background: #00ff00 !important; /* Bright green for correct */
  color: black !important;
  transform: translateY(2px);
}

/* Incorrect note highlighting - wrong answers */
#piano-keys .key.incorrect {
  background: #ff0000 !important; /* Bright red for incorrect */
  color: white !important;
  transform: translateY(2px);
}

#piano-keys .key.sharp.incorrect {
  background: #ff0000 !important; /* Bright red for incorrect */
  color: white !important;
  transform: translateY(2px);
}

/* Target note highlighting removed - ear training should use ears, not eyes! */

/* MIDI Input Selector */
.midi-input-selector {
  position: relative;
  width: 100%;
}

.midi-input-header {
  padding: 8px 12px;
  background: var(--panel);
  border: 1px solid #1e2633;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: background-color 0.2s ease;
  min-height: 40px;
}

.midi-input-header:hover {
  background: #151a24;
}

.midi-input-summary {
  font-size: 14px;
  color: var(--text);
  flex-grow: 1;
}

.dropdown-arrow {
  font-size: 12px;
  color: var(--muted);
  transition: transform 0.2s ease;
}

.midi-input-header.expanded .dropdown-arrow {
  transform: rotate(180deg);
}

.midi-input-dropdown {
  position: fixed;
  background: var(--panel);
  border: 1px solid #1e2633;
  border-radius: 8px;
  z-index: 1000;
  max-height: 200px;
  overflow-y: auto;
  display: none;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.midi-input-dropdown.show {
  display: block;
}

.midi-input-list {
  padding: 8px 0;
}

.midi-input-item {
  padding: 8px 12px;
  display: flex;
  align-items: center;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.midi-input-item:hover {
  background: #151a24;
}

.midi-input-item input[type="checkbox"] {
  margin-right: 8px;
  accent-color: var(--accent);
}

.midi-input-item label {
  margin: 0;
  cursor: pointer;
  font-size: 14px;
  color: var(--text);
  flex-grow: 1;
  display: flex;
  align-items: center;
  gap: 6px;
}

.bluetooth-icon {
  width: 14px;
  height: 14px;
  fill: var(--accent);
  flex-shrink: 0;
}

.device-type-icon {
  width: 14px;
  height: 14px;
  flex-shrink: 0;
  margin-left: auto;
}

.device-type-icon.melodic {
  fill: var(--good);
}

.device-type-icon.drum {
  fill: #ff9500;
}

.device-type-icon.controller {
  fill: var(--muted);
}

.midi-input-item.non-melodic {
  opacity: 0.6;
}

.midi-input-item.non-melodic:hover {
  opacity: 0.8;
}

/* MIDI Output Selector (reusing input selector styles) */
.midi-output-selector {
  position: relative;
  width: 100%;
}

.midi-output-header {
  padding: 8px 12px;
  background: var(--panel);
  border: 1px solid #1e2633;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: background-color 0.2s ease;
  min-height: 40px;
}

.midi-output-header:hover {
  background: #151a24;
}

.midi-output-summary {
  font-size: 14px;
  color: var(--text);
  flex-grow: 1;
}

.midi-output-header.expanded .dropdown-arrow {
  transform: rotate(180deg);
}

.midi-output-dropdown {
  position: fixed;
  background: var(--panel);
  border: 1px solid #1e2633;
  border-radius: 8px;
  z-index: 1000;
  max-height: 200px;
  overflow-y: auto;
  display: none;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.midi-output-dropdown.show {
  display: block;
}

.midi-output-list {
  padding: 8px 0;
}

.midi-output-item {
  padding: 8px 12px;
  display: flex;
  align-items: center;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.midi-output-item:hover {
  background: #151a24;
}

.midi-output-item input[type="checkbox"] {
  margin-right: 8px;
  accent-color: var(--accent);
}

.midi-output-item label {
  margin: 0;
  cursor: pointer;
  font-size: 14px;
  color: var(--text);
  flex-grow: 1;
  display: flex;
  align-items: center;
  gap: 6px;
}

/* Stats Screen Styles */
.stats-screen {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--bg);
  z-index: 2000;
  overflow-y: auto;
  padding: 20px;
  animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.stats-screen.loading {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  color: var(--muted);
}

.stats-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 24px;
  flex-wrap: wrap;
  gap: 16px;
}

.stats-header h1 {
  margin: 0;
  font-size: 28px;
  font-weight: 700;
}

.close-button {
  position: absolute;
  top: 20px;
  right: 20px;
  width: 40px;
  height: 40px;
  border: none;
  background: var(--panel);
  color: var(--text);
  border-radius: 50%;
  font-size: 24px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s ease;
}

.close-button:hover {
  background: #1a1f28;
}

.timeframe-selector {
  display: flex;
  align-items: center;
  gap: 8px;
}

.timeframe-selector label {
  font-size: 14px;
  color: var(--muted);
}

.timeframe-selector select {
  background: var(--panel);
  color: var(--text);
  border: 1px solid #1e2633;
  border-radius: 6px;
  padding: 6px 8px;
  font-size: 14px;
}

.no-data {
  text-align: center;
  padding: 60px 20px;
  color: var(--muted);
}

.no-data h2 {
  margin: 0 0 16px 0;
  font-size: 24px;
  color: var(--text);
}

.stats-overview {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 16px;
  margin-bottom: 32px;
}

.stat-card {
  background: var(--panel);
  border: 1px solid #1e2633;
  border-radius: 12px;
  padding: 20px;
  text-align: center;
  transition: transform 0.2s ease;
}

.stat-card:hover {
  transform: translateY(-2px);
}

.stat-value {
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 8px;
  color: var(--accent);
}

.stat-label {
  font-size: 14px;
  color: var(--muted);
  font-weight: 500;
}

.stats-section {
  margin-bottom: 32px;
}

.stats-section h2 {
  margin: 0 0 8px 0;
  font-size: 20px;
  font-weight: 600;
}

.section-subtitle {
  margin: 0 0 16px 0;
  font-size: 14px;
  color: var(--muted);
  line-height: 1.4;
}

.focus-hint {
  color: var(--accent);
  font-weight: 600;
}

.practice-button {
  background: var(--accent);
  color: var(--bg);
  border: none;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 11px;
  font-weight: 600;
  cursor: pointer;
  margin-left: 8px;
  transition: all 0.2s ease;
}

.practice-button:hover {
  background: var(--accent-hover);
  transform: translateY(-1px);
}

.weak-spots {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 12px;
}

.weak-spot {
  background: var(--panel);
  border: 1px solid #1e2633;
  border-radius: 8px;
  padding: 16px;
}

.note-name {
  font-weight: 600;
  margin-bottom: 8px;
  font-size: 16px;
}

.accuracy-bar {
  width: 100%;
  height: 8px;
  background: #1a1f28;
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 8px;
}

.accuracy-fill {
  height: 100%;
  border-radius: 4px;
  transition: width 0.3s ease;
}

.accuracy-text {
  font-size: 12px;
  color: var(--muted);
}

.todays-trend-chart {
  display: flex;
  align-items: end;
  gap: 8px;
  height: 100px;
  padding: 12px;
  background: var(--panel);
  border: 1px solid #1e2633;
  border-radius: 12px;
  overflow-x: auto;
}

.today-session {
  display: flex;
  flex-direction: column;
  justify-content: end;
  align-items: center;
  min-width: 40px;
  height: 100%;
}

.today-session-bar {
  width: 20px;
  min-height: 8px;
  border-radius: 4px 4px 0 0;
  transition: all 0.2s ease;
}

.today-session-bar:hover {
  opacity: 0.8;
}

.today-session-label {
  font-size: 11px;
  color: var(--muted);
  margin-top: 4px;
  text-align: center;
}

.trend-chart {
  display: flex;
  align-items: end;
  justify-content: space-between;
  height: 200px;
  padding: 20px;
  background: var(--panel);
  border: 1px solid #1e2633;
  border-radius: 12px;
  gap: 2px;
  overflow-x: auto;
}

.trend-bar {
  display: flex;
  flex-direction: column;
  justify-content: end;
  align-items: center;
  min-width: 20px;
  height: 100%;
  position: relative;
}

.trend-fill {
  width: 16px;
  min-height: 4px;
  border-radius: 2px 2px 0 0;
  transition: height 0.3s ease;
  margin-bottom: 8px;
}

.trend-label {
  position: absolute;
  bottom: -20px;
  font-size: 10px;
  color: var(--muted);
  white-space: nowrap;
  transform: rotate(-45deg);
  transform-origin: center;
}

.recent-sessions {
  display: grid;
  gap: 12px;
  max-height: 400px;
  overflow-y: auto;
}

.session-card {
  background: var(--panel);
  border: 1px solid #1e2633;
  border-radius: 8px;
  padding: 16px;
  transition: border-color 0.2s ease;
}

.session-card:hover {
  border-color: #2a3441;
}

.session-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.session-accuracy {
  font-size: 20px;
  font-weight: 700;
}

.session-time {
  font-size: 12px;
  color: var(--muted);
}

.session-settings {
  font-size: 14px;
  color: var(--text);
  margin-bottom: 4px;
}

.session-stats {
  font-size: 12px;
  color: var(--muted);
}

.stats-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 40px;
  padding-top: 20px;
  border-top: 1px solid #1e2633;
}

.secondary-button {
  background: transparent;
  color: var(--muted);
  border: 1px solid #1e2633;
  border-radius: 6px;
  padding: 8px 16px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.secondary-button:hover {
  background: var(--panel);
  color: var(--text);
}

.data-info {
  font-size: 12px;
  color: var(--muted);
}

/* Latest Sessions Display */
.latest-sessions {
  margin-top: 24px;
  padding: 16px;
  background: var(--panel);
  border: 1px solid #1e2633;
  border-radius: 12px;
}

.latest-sessions h3 {
  margin: 0 0 12px 0;
  font-size: 16px;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.view-all-button {
  background: none;
  border: none;
  color: var(--accent);
  font-size: 12px;
  cursor: pointer;
  text-decoration: underline;
  padding: 0;
}

.view-all-button:hover {
  color: #4dd0c7;
}

.latest-session-list {
  display: grid;
  gap: 8px;
}

.latest-session {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  background: #151a24;
  border-radius: 6px;
  font-size: 14px;
}

.latest-session-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.latest-session-accuracy {
  font-weight: 600;
  min-width: 40px;
}

.latest-session-settings {
  color: var(--muted);
  font-size: 12px;
}

.latest-session-time {
  font-size: 12px;
  color: var(--muted);
}

/* iPad and Mobile Responsive */
@media (max-width: 768px) {
  .stats-screen {
    padding: 16px;
  }
  
  .stats-header {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .stats-header h1 {
    font-size: 24px;
    padding-right: 50px;
  }
  
  .stats-overview {
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 12px;
  }
  
  .stat-card {
    padding: 16px;
  }
  
  .stat-value {
    font-size: 24px;
  }
  
  .weak-spots {
    grid-template-columns: 1fr;
  }
  
  .trend-chart {
    padding: 16px;
    height: 150px;
  }
  
  .stats-footer {
    flex-direction: column;
    gap: 16px;
    text-align: center;
  }
}

@media (max-width: 480px) {
  .stats-overview {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stat-card {
    padding: 12px;
  }
  
  .stat-value {
    font-size: 20px;
  }
  
  .stat-label {
    font-size: 12px;
  }
}
